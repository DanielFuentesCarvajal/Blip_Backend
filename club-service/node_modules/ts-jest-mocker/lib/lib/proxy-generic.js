"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createGenericProxy = void 0;
const functions_filter_1 = require("./functions-filter");
const config_1 = require("./config");
const defaultConfig = {
    excludeMethodNames: [
        // "then" is excluded in order to avoid issues with Promises. By standard, if object has "then" method it's "thenable" and
        // "promises will and should assimilate anything with a then method". See https://promisesaplus.com/#point-53 for more details.
        'then',
        // for .toEqual() to work (Jest)
        Symbol.iterator,
    ],
    failIfMockNotProvided: true,
    includeMethodNames: [],
};
const createGenericProxy = (mockConfig) => {
    const config = config_1.MergedConfig.merge(defaultConfig, mockConfig);
    return new Proxy({}, {
        get: (target, property) => {
            if (property in target) {
                return target[property];
            }
            if (!functions_filter_1.FunctionsFilter.shouldFilter(property, config)) {
                target[property] = jest.fn();
                if (config.failIfMockNotProvided) {
                    target[property].mockImplementation(() => {
                        throw new Error(`Method '${String(property)}' is not mocked`);
                    });
                }
            }
            return target[property];
        },
    });
};
exports.createGenericProxy = createGenericProxy;
